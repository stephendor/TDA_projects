# TDA Kafka Cluster Environment Configuration
# This file contains environment-specific settings for the Kafka cluster

# =============================================================================
# ENVIRONMENT SETTINGS
# =============================================================================
ENVIRONMENT=development
TDA_KAFKA_CLUSTER_NAME=tda-kafka-cluster
COMPOSE_PROJECT_NAME=tda-kafka

# =============================================================================
# KAFKA BROKER CONFIGURATION
# =============================================================================

# Basic Broker Settings
KAFKA_BROKER_COUNT=3
KAFKA_DEFAULT_PARTITIONS=3
KAFKA_DEFAULT_REPLICATION_FACTOR=3
KAFKA_MIN_INSYNC_REPLICAS=2

# Connection Settings
KAFKA_BOOTSTRAP_SERVERS=localhost:19092,localhost:19093,localhost:19094
KAFKA_INTERNAL_BOOTSTRAP_SERVERS=kafka-1:9092,kafka-2:9092,kafka-3:9092

# Topic Prefix (useful for multi-tenancy)
KAFKA_TOPIC_PREFIX=tda_

# =============================================================================
# ZOOKEEPER CONFIGURATION
# =============================================================================

# ZooKeeper Ensemble
ZOOKEEPER_SERVERS=zookeeper-1:2181,zookeeper-2:2181,zookeeper-3:2181
ZOOKEEPER_SESSION_TIMEOUT_MS=30000
ZOOKEEPER_CONNECTION_TIMEOUT_MS=6000

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Memory Settings
KAFKA_HEAP_SIZE=2G
KAFKA_HEAP_OPTS="-Xmx2G -Xms2G"

# JVM Performance Options
KAFKA_JVM_PERFORMANCE_OPTS=-XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent

# Network Settings
KAFKA_NUM_NETWORK_THREADS=8
KAFKA_NUM_IO_THREADS=8
KAFKA_SOCKET_SEND_BUFFER_BYTES=102400
KAFKA_SOCKET_RECEIVE_BUFFER_BYTES=102400
KAFKA_SOCKET_REQUEST_MAX_BYTES=104857600

# Replication Settings
KAFKA_NUM_REPLICA_FETCHERS=4
KAFKA_REPLICA_FETCH_MAX_BYTES=1048576
KAFKA_REPLICA_FETCH_RESPONSE_MAX_BYTES=10485760

# Producer Settings
KAFKA_PRODUCER_BATCH_SIZE=65536
KAFKA_PRODUCER_LINGER_MS=10
KAFKA_PRODUCER_COMPRESSION_TYPE=lz4
KAFKA_PRODUCER_BUFFER_MEMORY=67108864
KAFKA_PRODUCER_MAX_REQUEST_SIZE=1048576

# Consumer Settings
KAFKA_CONSUMER_FETCH_MIN_BYTES=65536
KAFKA_CONSUMER_FETCH_MAX_WAIT_MS=500
KAFKA_CONSUMER_MAX_POLL_RECORDS=1000
KAFKA_CONSUMER_SESSION_TIMEOUT_MS=30000
KAFKA_CONSUMER_HEARTBEAT_INTERVAL_MS=10000

# =============================================================================
# DATA RETENTION POLICIES (based on TDA architecture)
# =============================================================================

# Default Retention Settings
KAFKA_LOG_RETENTION_HOURS=168
KAFKA_LOG_RETENTION_BYTES=1073741824
KAFKA_LOG_SEGMENT_BYTES=1073741824
KAFKA_LOG_RETENTION_CHECK_INTERVAL_MS=300000

# TDA-specific Topic Retention (in milliseconds)
# Jobs: 7 days
TDA_JOBS_RETENTION_MS=604800000
TDA_JOBS_RETENTION_BYTES=1073741824

# Results: 30 days with compaction
TDA_RESULTS_RETENTION_MS=2592000000
TDA_RESULTS_RETENTION_BYTES=5368709120
TDA_RESULTS_CLEANUP_POLICY=compact
TDA_RESULTS_MIN_CLEANABLE_DIRTY_RATIO=0.1
TDA_RESULTS_MAX_COMPACTION_LAG_MS=3600000

# Events: 14 days
TDA_EVENTS_RETENTION_MS=1209600000
TDA_EVENTS_RETENTION_BYTES=536870912

# Uploads: 3 days (temporary data)
TDA_UPLOADS_RETENTION_MS=259200000
TDA_UPLOADS_RETENTION_BYTES=2147483648

# Errors: 30 days (for analysis)
TDA_ERRORS_RETENTION_MS=2592000000
TDA_ERRORS_RETENTION_BYTES=1073741824

# =============================================================================
# TOPIC CONFIGURATIONS
# =============================================================================

# TDA Topics List
TDA_TOPICS="tda_jobs,tda_results,tda_events,tda_uploads,tda_errors"

# Topic Partition Configuration
TDA_JOBS_PARTITIONS=3
TDA_RESULTS_PARTITIONS=3
TDA_EVENTS_PARTITIONS=1
TDA_UPLOADS_PARTITIONS=2
TDA_ERRORS_PARTITIONS=1

# Topic Replication Factor
TDA_JOBS_REPLICATION_FACTOR=3
TDA_RESULTS_REPLICATION_FACTOR=3
TDA_EVENTS_REPLICATION_FACTOR=3
TDA_UPLOADS_REPLICATION_FACTOR=3
TDA_ERRORS_REPLICATION_FACTOR=3

# =============================================================================
# SECURITY SETTINGS
# =============================================================================

# Security Protocol (PLAINTEXT for development, SSL/SASL for production)
KAFKA_SECURITY_PROTOCOL=PLAINTEXT
KAFKA_SASL_MECHANISM=PLAIN

# SSL Settings (uncomment for production)
# KAFKA_SSL_KEYSTORE_LOCATION=/etc/kafka/secrets/kafka.keystore.jks
# KAFKA_SSL_KEYSTORE_PASSWORD=kafka_keystore_password
# KAFKA_SSL_KEY_PASSWORD=kafka_key_password
# KAFKA_SSL_TRUSTSTORE_LOCATION=/etc/kafka/secrets/kafka.truststore.jks
# KAFKA_SSL_TRUSTSTORE_PASSWORD=kafka_truststore_password

# SASL Settings (uncomment for production)
# KAFKA_SASL_ENABLED_MECHANISMS=SCRAM-SHA-256
# KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL=SCRAM-SHA-256

# =============================================================================
# MONITORING AND LOGGING
# =============================================================================

# JMX Settings
KAFKA_JMX_ENABLED=true
KAFKA_JMX_PORT_BASE=9101

# Log Levels
KAFKA_LOG4J_ROOT_LOGLEVEL=INFO
KAFKA_LOG4J_LOGGERS=kafka.authorizer.logger=INFO,kafka.controller=INFO

# Metrics
KAFKA_METRIC_REPORTERS=
KAFKA_CONFLUENT_METRICS_ENABLE=false

# =============================================================================
# SCHEMA REGISTRY CONFIGURATION
# =============================================================================

SCHEMA_REGISTRY_HOST=schema-registry
SCHEMA_REGISTRY_PORT=8081
SCHEMA_REGISTRY_URL=http://schema-registry:8081
SCHEMA_REGISTRY_COMPATIBILITY_LEVEL=backward

# =============================================================================
# KAFKA CONNECT CONFIGURATION
# =============================================================================

KAFKA_CONNECT_GROUP_ID=tda-connect-group
KAFKA_CONNECT_CONFIG_STORAGE_TOPIC=_connect-configs
KAFKA_CONNECT_OFFSET_STORAGE_TOPIC=_connect-offsets
KAFKA_CONNECT_STATUS_STORAGE_TOPIC=_connect-status
KAFKA_CONNECT_KEY_CONVERTER=org.apache.kafka.connect.storage.StringConverter
KAFKA_CONNECT_VALUE_CONVERTER=io.confluent.connect.avro.AvroConverter

# =============================================================================
# KSQLDB CONFIGURATION
# =============================================================================

KSQLDB_SERVER_HOST=ksqldb-server
KSQLDB_SERVER_PORT=8088
KSQLDB_PROCESSING_GUARANTEE=exactly_once

# =============================================================================
# DEVELOPMENT OVERRIDES
# =============================================================================

# Development-specific settings (can be overridden in production)
KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
KAFKA_DELETE_TOPIC_ENABLE=true
KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false
KAFKA_AUTO_LEADER_REBALANCE_ENABLE=true

# Reduced settings for development
KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=3000
KAFKA_OFFSETS_RETENTION_MINUTES=10080
KAFKA_TRANSACTION_STATE_LOG_NUM_PARTITIONS=3

# =============================================================================
# PRODUCTION OVERRIDES (uncomment for production)
# =============================================================================

# Production-specific settings
# KAFKA_AUTO_CREATE_TOPICS_ENABLE=false
# KAFKA_DELETE_TOPIC_ENABLE=false
# KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false
# KAFKA_AUTO_LEADER_REBALANCE_ENABLE=true

# Increased settings for production
# KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=3000
# KAFKA_OFFSETS_RETENTION_MINUTES=43200
# KAFKA_TRANSACTION_STATE_LOG_NUM_PARTITIONS=50

# Higher performance settings for production
# KAFKA_NUM_PARTITIONS=12
# KAFKA_HEAP_SIZE=32G
# KAFKA_NUM_NETWORK_THREADS=16
# KAFKA_NUM_IO_THREADS=16

# =============================================================================
# EXTERNAL SYSTEM INTEGRATION
# =============================================================================

# PostgreSQL Integration (for persistent storage)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=tda_platform
POSTGRES_USER=tda_user
POSTGRES_PASSWORD=tda_password

# Redis Integration (for caching)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=kafka_redis_2024

# S3/MinIO Integration (for file storage)
S3_ENDPOINT=http://minio:9000
S3_ACCESS_KEY=tda_access_key
S3_SECRET_KEY=tda_secret_key
S3_BUCKET_PREFIX=tda-

# =============================================================================
# BACKUP AND RECOVERY
# =============================================================================

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"
BACKUP_RETENTION_DAYS=30
BACKUP_LOCATION=/backup/kafka

# Recovery Settings
RECOVERY_MODE=false
RECOVERY_SOURCE_PATH=/backup/kafka/latest

# =============================================================================
# ALERTING AND NOTIFICATIONS
# =============================================================================

# Alert Thresholds
ALERT_CONSUMER_LAG_THRESHOLD=1000
ALERT_DISK_USAGE_THRESHOLD=80
ALERT_MEMORY_USAGE_THRESHOLD=85
ALERT_ERROR_RATE_THRESHOLD=0.1

# Notification Settings
ALERT_EMAIL_ENABLED=false
ALERT_EMAIL_SMTP_SERVER=smtp.example.com
ALERT_EMAIL_FROM=kafka-alerts@tda-platform.com
ALERT_EMAIL_TO=admin@tda-platform.com

# Slack Integration
ALERT_SLACK_ENABLED=false
ALERT_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# =============================================================================
# CUSTOM APPLICATION SETTINGS
# =============================================================================

# TDA-specific Configuration
TDA_COMPUTE_TIMEOUT_MS=300000
TDA_MAX_CONCURRENT_JOBS=100
TDA_RESULT_CACHE_TTL_SECONDS=3600
TDA_UPLOAD_MAX_SIZE_MB=100

# Feature Flags
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_REAL_TIME_PROCESSING=true
FEATURE_BATCH_PROCESSING=true
FEATURE_STREAM_PROCESSING=true

# API Configuration
API_VERSION=v1
API_RATE_LIMIT_PER_MINUTE=1000
API_MAX_REQUEST_SIZE_MB=10

# =============================================================================
# DEBUG AND TROUBLESHOOTING
# =============================================================================

# Debug Settings (set to true for detailed logging)
KAFKA_DEBUG=false
KAFKA_TRACE=false
ZOOKEEPER_DEBUG=false

# Performance Monitoring
ENABLE_JMX_MONITORING=true
ENABLE_PROMETHEUS_METRICS=true
ENABLE_HEALTH_CHECKS=true

# Log Retention for Debug
DEBUG_LOG_RETENTION_HOURS=24
DEBUG_LOG_MAX_SIZE_MB=1000